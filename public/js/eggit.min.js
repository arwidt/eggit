var app=app||{};app.settings={start:{desc:"How do you like your eggs?<br/>Choose below.",current:"<%= boiled %> perfect eggs boiled so far!"},eggsize:{desc:"How big are your eggs?",extra:"A normal egg weighs between 53-63 grams, but some larger eggs can weigh up to 90 grams."},prep:{desc:"Start boiling the water. Prick your eggs while waiting. Put the eggs in the boiling water and then press start.",btnlabel:"START"},boil:{desc:"Boil your eggs until the time runs out.",btnlabel:"CANCEL"},rinse:{desc:"Rinse your eggs in cold water.",btnlabel:"CANCEL"},wait:{desc:"Let your eggs lie in the cold water.",btnlabel:"CANCEL"},end:{desc:"Enjoy your perfectly boiled eggs!",extra:"",btnlabel:"KEEP BOILING"},time:{boil:30,rinse:30,wait:30,typefactor:{soft:.9,medium:1,hard:1.1},sizefactor:{small:.9,medium:1,big:1.1}}},$(function(){"use strict";console.log("start"),app.model=new app.EggitModel,app.view=new app.EggitView,app.model.set({typeData:app.settings.start,currentStep:"start"})});
var app=app||{};!function(t){"use strict";app.EggitClock=Backbone.View.extend({svgId:"",totalSeconds:"",clock:null,clockGroup:null,clockHead:null,minuteText:null,min_sec:null,dgr:null,mat:null,initialize:function(t){this.clock=Snap.select(t),this.clockGroup=this.clock.select("#clock"),this.time=0;var i=TimeConvert.seconds_to_minutes_and_secondsrest(this.time),o=this.clock.select("#head_center"),n=this.clock.select("#head_line"),e=this.clock.select("#head_end");this.minuteText=this.clock.text(58,60,i[0]+" min"),this.clockHead=this.clock.group(o,n,e),this.colorBody=this.clock.select("#color_body")},update_time:function(t){this.min_sec=TimeConvert.seconds_to_minutes_and_secondsrest(t),this.minuteText.node.textContent=this.min_sec[0]+" min",this.dgr=6*this.min_sec[1],this.mat=Snap.matrix(),this.mat.rotate(this.dgr,71.563,75),this.clockHead.transform(this.mat)},set_color:function(t){this.colorBody.attr({fill:t})},alarm:function(){console.log("ALARM!!");var i=50;t("#clock").transition({scale:1.3,y:-40},500).transition({rotate:"5"},i).transition({rotate:"-5"},i).transition({rotate:"5"},i).transition({rotate:"-5"},i).transition({rotate:"5"},i).transition({rotate:"-5"},i).transition({rotate:"5"},i).transition({rotate:"-5"},i).transition({rotate:"5"},i).transition({rotate:"-5"},i).transition({rotate:"5"},i).transition({rotate:"-5"},i).transition({rotate:"5"},i).transition({rotate:"-5"},i).transition({rotate:"0"},i).transition({delay:400,rotate:"0",y:0,scale:1},500)},render:function(){}})}(jQuery);
var app=app||{};!function(){"use strict";app.EggitModel=Backbone.Model.extend({defaults:{title:"",currentStep:"",typeData:null,egg_type:0,egg_size:0,boiltime:0,rinsetime:0,waittime:0,time:0,timer:null},initialize:function(){console.log("initialize model")},set_times:function(){var t=(this.get("egg_type"),this.get("egg_size"),{boiltime:Math.ceil(app.settings.time.boil),rinsetime:Math.ceil(app.settings.time.rinse),waittime:Math.ceil(app.settings.time.wait)});this.set(t)},start_time:function(t){console.log("start_time",t);var e=this;this.set({time:t}),this.attributes.timer=setInterval(function(){e.update_timer()},50)},stop_time:function(){console.log("stop_time"),clearInterval(this.attributes.timer)},update_timer:function(){this.set("time",this.get("time")-1),this.get("time")<=0&&(this.set("time",0),this.stop_time())}})}();
var app=app||{};!function(t){"use strict";app.EggitView=Backbone.View.extend({el:"",timeVisual:null,clock:null,bottom_btn:null,initialize:function(){var e=this;this.el=t("#apparea"),this.bottom_btn=t(".bottom_btn"),this.bottom_btn.css({opacity:0,y:10}),t(this.bottom_btn).find("button").click(function(){app.model.stop_time(),app.model.set({typeData:app.settings.start,currentStep:"start"})}),this.initTemplates(),this.listenTo(app.model,"change:currentStep",e.change_currentStep),this.listenTo(app.model,"change:time",e.change_time)},initTemplates:function(){this.templates={start:t("#template_start"),eggsize:t("#template_eggsize"),prep:t("#template_prep"),boil:t("#template_boil"),rinse:t("#template_rinse"),wait:t("#template_wait"),end:t("#template_end")}},change_currentStep:function(){var e,i=this;switch(app.model.get("currentStep")){case"start":this.hide_bottom_btn(),i.el.transition({opacity:0,x:10},function(){e=app.model.get("typeData");var a={desc:e.desc},n=_.template(i.templates.start.html())(a);i.el.html(n);var p=t("#softbtn"),o=t("#mediumbtn"),s=t("#hardbtn");p.on("click",function(){app.model.set({egg_type:0,typeData:app.settings.eggsize,currentStep:"size"})}),p.hover(function(){p.transition({scale:1.05,y:-5},50)},function(){p.transition({scale:1,y:0},50)}),o.click(function(){app.model.set({egg_type:1,typeData:app.settings.eggsize,currentStep:"size"})}),o.hover(function(){o.transition({scale:1.05,y:-5},50)},function(){o.transition({scale:1,y:0},50)}),s.click(function(){app.model.set({egg_type:2,typeData:app.settings.eggsize,currentStep:"size"})}),s.hover(function(){s.transition({scale:1.05,y:-5},50)},function(){s.transition({scale:1,y:0},50)})}).transition({opacity:1,x:0},500);break;case"size":this.el.transition({opacity:0,x:-10},500,function(){e=app.model.get("typeData"),i.el.css({x:10}),i.el.html(_.template(i.templates.eggsize.html())(e));var a=t("#smallbtn"),n=t("#medbtn"),p=t("#bigbtn");a.click(function(){app.model.set({egg_size:0,typeData:app.settings.prep,currentStep:"prep"})}),a.hover(function(){a.transition({scale:1.05,y:-5},50)},function(){a.transition({scale:1,y:0},50)}),n.click(function(){app.model.set({egg_size:1,typeData:app.settings.prep,currentStep:"prep"})}),n.hover(function(){n.transition({scale:1.05,y:-5},50)},function(){n.transition({scale:1,y:0},50)}),p.click(function(){app.model.set({egg_size:2,typeData:app.settings.prep,currentStep:"prep"})}),p.hover(function(){p.transition({scale:1.05,y:-5},50)},function(){p.transition({scale:1,y:0},50)})}).transition({opacity:1,x:0},500);break;case"prep":this.el.transition({opacity:0,x:-10},500,function(){e=app.model.get("typeData"),i.el.css({x:10}),i.el.html(_.template(i.templates.prep.html())(e)),app.model.set_times(),t(".prep_btn .btn").click(function(){app.model.set({typeData:app.settings.boil,currentStep:"boil"}),app.model.start_time(app.model.get("boiltime"))})}).transition({opacity:1,x:0},500);break;case"boil":this.el.transition({opacity:0,x:-10},500,function(){e=app.model.get("typeData"),i.el.css({x:10}),i.el.html(_.template(i.templates.boil.html())(e)),i.clock=new app.EggitClock("#clock_svg",90),i.clock.update_time(app.model.get("boiltime")),i.show_bottom_btn(e.btnlabel),t(".step_boil .btn").click(function(){app.model.stop_time(),app.model.set({currentStep:"start"})})}).transition({opacity:1,x:0},500);break;case"rinse":this.el.transition({opacity:0,x:-10},500,function(){e=app.model.get("typeData"),i.show_bottom_btn(e.btnlabel),i.el.css({x:10}),i.el.html(_.template(i.templates.rinse.html())(e)),i.clock=new app.EggitClock("#clock_svg",90),i.clock.update_time(app.model.get("rinsetime")),t(".step_rinse .btn").click(function(){app.model.stop_time(),app.model.set({currentStep:"start"})})}).transition({opacity:1,x:0},500);break;case"wait":this.el.transition({opacity:0,x:-10},500,function(){e=app.model.get("typeData"),i.show_bottom_btn(e.btnlabel),i.el.css({x:10}),i.el.html(_.template(i.templates.wait.html())(e)),i.clock=new app.EggitClock("#clock_svg",90),i.clock.update_time(app.model.get("waittime"))}).transition({opacity:1,x:0},500);break;case"end":this.el.transition({opacity:0,x:-10},500,function(){e=app.model.get("typeData"),i.show_bottom_btn(e.btnlabel),i.el.css({x:10}),i.el.html(_.template(i.templates.end.html())(e))}).transition({opacity:1,x:0},500)}},change_time:function(){var t=function(t){app.model.start_time(t)};if(this.clock){var e=app.model.get("time");if(this.update_clock(e),0>=e)switch(app.model.get("currentStep")){case"boil":app.model.stop_time(),this.clock.alarm(),_.delay(function(){app.model.set({typeData:app.settings.rinse,currentStep:"rinse"})},3e3),_.delay(t,5e3,app.model.get("rinsetime"));break;case"rinse":app.model.stop_time(),this.clock.alarm(),_.delay(function(){app.model.set({typeData:app.settings.wait,currentStep:"wait"})},3e3),_.delay(t,5e3,app.model.get("waittime"));break;case"wait":app.model.stop_time(),this.clock.alarm(),_.delay(function(){app.model.set({typeData:app.settings.end,currentStep:"end"})},3e3)}}},update_clock:function(t){this.clock&&this.clock.update_time(t)},show_bottom_btn:function(t){this.bottom_btn.find("button").html(t),this.bottom_btn.css({visibility:"visible"}),this.bottom_btn.transition({delay:500,opacity:1,y:0},500)},hide_bottom_btn:function(){var t=this;this.bottom_btn.transition({opacity:0,y:10},300,function(){t.bottom_btn.css({visibility:"hidden"})})},render:function(){}})}(jQuery);
var TimeConvert=function(){return{milliseconds_to_seconds:function(n){return n/1e3},milliseconds_to_minutes:function(n){return n/1e3/60},milliseconds_to_mmss:function(n){var o=Math.floor(n/1e3),t=Math.floor(o/60);return o-=60*t,10>t&&(t="0"+t),10>o&&(o="0"+o),t+":"+o},seconds_to_minutes_and_secondsrest:function(n){return[Math.floor(Math.min(n/60)),n-60*Math.floor(Math.min(n/60))]}}}();